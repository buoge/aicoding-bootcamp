## 项目名称

project-alpha：基于标签的 Ticket 管理工具，旨在提供简洁高效的任务跟踪和分类功能。系统采用现代化的技术栈，提供直观的用户界面和稳定的后端服务。

---

## 一、项目背景与目标

### 1.1 背景

在日常开发和工作中，我们经常需要记录和跟踪各种事项，例如：
- 功能需求
- Bug / 缺陷
- 技术债务
- 学习任务与灵感

传统的 ToDo 工具往往只提供简单的列表和勾选功能，难以根据不同的维度进行分类与筛选；而成熟的 Issue/Ticket 系统（如 Jira、GitHub Issues）又过于复杂，不适合个人或小团队快速上手和日常使用。

因此需要一个**足够简单，但支持按标签灵活分类与筛选的 Ticket 管理工具**。

### 1.2 目标

project-alpha 的目标是：

- **快速记录**：以最少的字段创建一个 Ticket；
- **灵活分类**：通过多标签机制，对 Ticket 进行灵活的组合分类；
- **高效筛选**：按标签、标题关键字等维度快速筛选 Ticket；
- **轻量易用**：不引入用户系统，通过一个简单 Web 界面即可使用；
- **利于扩展**：后端数据库和 API 设计要为后续增加功能（例如优先级、截止日期等）预留空间。

---

## 二、术语与角色定义

- **Ticket**：记录一条事项，例如一个任务、Bug、想法等，是系统的核心实体。
- **标签（Tag）**：用于对 Ticket 进行分类的短文本标识，一个 Ticket 可以有多个标签。
- **当前用户**：系统暂不实现多用户与登录机制，默认所有操作均由“当前用户”完成，可视为单人使用或共享账号使用。

---

## 三、功能需求（Functional Requirements）

### 3.1 Ticket 基础管理

#### 3.1.1 创建 Ticket
- **必填字段**
  - `title`：标题，简要描述 Ticket 内容。
- **可选字段**
  - `description`：详细描述，支持多行文本。
  - `tags`：标签列表（0 个或多个），从已有标签中选择或输入新标签。
- **系统自动字段**
  - `id`：主键，自增或 UUID。
  - `status`：状态，默认 `open`。
  - `created_at`：创建时间。
  - `updated_at`：最后更新时间。
- **交互要求**
  - 在前端提供简洁的创建表单（可作为弹窗、抽屉或页面内表单）。
  - 创建成功后：
    - 清空表单；
    - 将新建 Ticket 立即显示在列表中（无需刷新整个页面）。

#### 3.1.2 编辑 Ticket
- 支持编辑以下字段：
  - `title`
  - `description`
  - 关联的 `tags`（通过标签管理相关功能实现）
- 不允许直接编辑：
  - `id`
  - `created_at`
- 编辑成功后：
  - 更新 `updated_at` 字段；
  - 列表中的对应项内容即时更新。

#### 3.1.3 删除 Ticket
- 支持在列表或详情中删除 Ticket。
- 删除前应有二次确认（弹窗或确认提示）。
- 删除后：
  - 数据库中对应记录被硬删除（本版本采用硬删除，后续扩展可考虑软删除）；
  - 列表中该项立即消失。

#### 3.1.4 完成 / 取消完成 Ticket
- Ticket 状态枚举：
  - `open`：未完成
  - `done`：已完成
- 功能要求：
  - 支持从 `open` 切换为 `done`（标记完成）；
  - 支持从 `done` 切换回 `open`（取消完成）。
- 交互要求：
  - 在列表中提供明显的完成/取消完成操作（如复选框或按钮）。
  - 完成的 Ticket 在 UI 上有明显区分（如浅色、加删除线或标记“已完成”）。

### 3.2 标签管理与使用

#### 3.2.1 给 Ticket 添加标签
- 在创建或编辑 Ticket 时，可以：
  - 从现有标签列表中多选；
  - 输入新标签名称并创建（若不存在）。
- 同一个 Ticket 可以关联**多个标签**。
- 不限制标签的字符集（支持中英文、数字），但需限制长度（如 1–32 字符）。

#### 3.2.2 删除 Ticket 的标签
- 在编辑 Ticket 标签时，可以移除某个已选标签。
- 删除标签与“删除标签实体”不同：
  - 这里只是解除 Ticket 与某个标签的关联，不会删除这个标签本身。

#### 3.2.3 标签全局管理（可选简化）
- 本版本中不强制要求提供独立的“标签管理页面”，但需要：
  - 后端支持读取**全量标签列表**及每个标签关联的 Ticket 数量；
  - 供前端用于下拉选择和筛选 UI。

### 3.3 Ticket 列表与筛选

#### 3.3.1 按标签查看 Ticket 列表
- 前端应提供按标签筛选功能：
  - 选择一个或多个标签后，展示**同时包含这些标签**的 Ticket 列表（逻辑为 AND，非 OR）；
  - 若未选择任何标签，则展示所有 Ticket。
- 支持的筛选组合：
  - 单标签：显示拥有该标签的 Ticket；
  - 多标签：显示**包含所有选中标签**的 Ticket。

#### 3.3.2 按标题搜索 Ticket
- 搜索条件：
  - 关键字基于 `title` 字段；
  - 匹配方式：包含匹配（LIKE %keyword%）。
- 交互要求：
  - 列表上方提供搜索输入框；
  - 输入后进行搜索，建议前端实现输入防抖；
  - 搜索可以与标签筛选**叠加**使用：
    - 在满足标签条件的结果集中，再按标题关键字过滤。

#### 3.3.3 列表排序与分页（本期简化）
- 默认排序：
  - 按 `created_at` 降序（最新创建的在最上面）。
- 本期可以不实现分页，在数据量较小时使用简单列表即可。
  - 若实现分页，建议后端使用偏移量/限制（OFFSET/LIMIT）或基于 id 的游标分页。

### 3.4 其他非必需但推荐的小功能

（可视为加分项或后续扩展）
- 显示每个标签所关联的 Ticket 数量；
- 支持按状态筛选（例如仅查看“未完成”的 Ticket）；
- 支持将某些常用标签固定展示在页面上方作为快捷筛选按钮。

---

## 四、非功能需求（Non-Functional Requirements）

### 4.1 性能

- 针对小规模团队或个人场景，数据量预期为数千级别以内；
- 在此数据量下，常规的查询和筛选应在**200ms 内**完成（不考虑网络延迟）。

### 4.2 可用性（Usability）

- UI 简洁直观，新用户无需文档即可上手；
- 操作按钮、链接需有明确的文字或图标说明；
- 对关键操作（删除 Ticket）提供确认提示，以防误操作；
- 表单校验失败时，给出清晰的错误信息。

### 4.3 可维护性与可扩展性

- 后端：
  - 采用清晰的分层结构（如路由层、服务层、数据访问层分离）；
  - 数据库模型要便于扩展字段（例如优先级、截止日期、附件等）。
- 前端：
  - 使用组件化设计，可复用的 UI 组件（按钮、表单、弹窗、标签等）；
  - 清晰的状态管理（优先使用组合式 API 和局部状态，必要时可引入简单的全局状态管理，如 Pinia）。

### 4.4 技术栈约束

- **数据库**：Postgres
- **后端**：FastAPI（Python）
- **前端**：TypeScript + Vite + Vue3
- 不要求用户登录/权限管理，本期所有操作视为同一用户。
- 直接使用本地 Postgres 数据库，数据库名称为 projectalpha，用户名称为 postgres，密码为 postgres

---

## 五、系统架构设计

### 5.1 总体架构

系统采用典型的前后端分离架构：

- **前端**：基于 TypeScript/Vite/Vue3 构建单页应用（SPA）；
- **后端**：使用 FastAPI 提供 RESTful API；
- **数据库**：Postgres 存储 Ticket 和标签相关数据；
- 前端通过 HTTP/JSON 与后端通信。

整体结构示意：

- 浏览器（前端 SPA：Vue3）
  - ⬇️⬆️ HTTP/JSON
- FastAPI 应用（后端）
  - ⬇️⬆️ SQL/ORM
- Postgres 数据库

### 5.2 模块划分

- 前端模块
  - 页面视图
    - Ticket 列表页（主页面）
    - Ticket 编辑/创建表单（可为弹窗/抽屉）
  - 组件
    - `TicketList`：Ticket 列表组件
    - `TicketItem`：单个 Ticket 展示与操作组件
    - `TagSelector`：标签选择组件（支持多选和新建标签）
    - `TicketForm`：创建/编辑表单组件
    - 顶部筛选/搜索组件
  - 网络层
    - 封装对后端 API 的调用函数（如 `useTicketsApi` / `useTagsApi` 钩子或工具模块）

- 后端模块
  - API 路由
    - `/tickets`：与 Ticket 相关的增删改查
    - `/tags`：标签列表查询等
  - 服务层
    - TicketService：处理业务逻辑（创建、编辑、标签关联、筛选等）
    - TagService：标签创建、查询等
  - 数据访问层（DAO/Repository）
    - 通过 ORM 或 SQL 与 Postgres 交互

---

## 六、数据模型设计

### 6.1 概念模型

主要实体：
- Ticket
- Tag

关系：
- Ticket 与 Tag 为多对多关系：
  - 一个 Ticket 可以有多个 Tag；
  - 一个 Tag 也可以被多个 Ticket 使用。

因此需要中间关联表表示多对多关系。

### 6.2 逻辑模型（数据库表结构）

#### 6.2.1 表：`tickets`

- `id`：主键，`BIGSERIAL` 或 `UUID`；
- `title`：`VARCHAR(255)`，非空；
- `description`：`TEXT`，可空；
- `status`：`VARCHAR(16)`，非空，取值限定为 `open` / `done`；
- `created_at`：`TIMESTAMPTZ`，非空，默认 `NOW()`；
- `updated_at`：`TIMESTAMPTZ`，非空，默认 `NOW()`，更新时自动刷新。

索引：
- `PRIMARY KEY (id)`
- `INDEX tickets_status_idx (status)`
- `INDEX tickets_title_idx (title)`（可选，用于 LIKE 查询时优化；也可考虑使用 `GIN` + `to_tsvector` 做全文搜索，但本期可以不做。）

#### 6.2.2 表：`tags`

- `id`：主键，`BIGSERIAL` 或 `UUID`；
- `name`：`VARCHAR(64)`，非空，唯一；
- `created_at`：`TIMESTAMPTZ`，非空，默认 `NOW()`。

索引：
- `UNIQUE (name)`

#### 6.2.3 表：`ticket_tags`

多对多关联表。

- `ticket_id`：外键，引用 `tickets.id`；
- `tag_id`：外键，引用 `tags.id`；

联合唯一约束：
- `UNIQUE (ticket_id, tag_id)`，防止重复关联。

索引：
- `INDEX ticket_tags_ticket_id_idx (ticket_id)`
- `INDEX ticket_tags_tag_id_idx (tag_id)`

---

## 七、API 设计（FastAPI）

所有 API 均返回 JSON，若无特殊说明，路径前缀可统一为 `/api`。

### 7.1 Ticket 相关 API

#### 7.1.1 创建 Ticket

- **Method**：`POST`
- **Path**：`/api/tickets`
- **Request Body（JSON）**：
  - `title`：string，必填；
  - `description`：string，可选；
  - `tag_ids`：number[]，可选；或 `tag_names`：string[]（用于创建新标签，具体实现可灵活选择，本期建议使用 `tag_ids`，前端先创建标签后再传 id）。
- **Response（201 Created）**：
  - 返回创建后的完整 Ticket 对象（包含标签信息）。

#### 7.1.2 更新 Ticket

- **Method**：`PUT` 或 `PATCH`
- **Path**：`/api/tickets/{id}`
- **Request Body（JSON）**（全部字段可选）：
  - `title`：string
  - `description`：string
  - `status`：`"open"` | `"done"`
  - `tag_ids`：number[]（若提供，则视为完整替换 Ticket 与标签的关联关系）
- **Response（200 OK）**：
  - 返回更新后的 Ticket 对象。

#### 7.1.3 删除 Ticket

- **Method**：`DELETE`
- **Path**：`/api/tickets/{id}`
- **Response（204 No Content）**：
  - 无 body。

#### 7.1.4 获取 Ticket 详情

- **Method**：`GET`
- **Path**：`/api/tickets/{id}`
- **Response（200 OK）**：
  - 返回 Ticket 详情，包括：
    - 基本信息字段；
    - 关联的标签列表。

#### 7.1.5 获取 Ticket 列表（含筛选）

- **Method**：`GET`
- **Path**：`/api/tickets`
- **Query 参数**：
  - `tag_ids`：string，可选；例如 `tag_ids=1,2` 表示同时包含标签 1 和 2 的 Ticket；
  - `search`：string，可选；对 `title` 做包含匹配；
  - `status`：string，可选；`open` / `done`（若实现状态筛选）；
  - `order_by`：string，可选，默认 `created_at_desc`；
  - `limit`：number，可选，默认值如 50；
  - `offset`：number，可选，默认值如 0。
- **Response（200 OK）**：
  - `items`：Ticket 列表（含标签数组）；
  - `total`：满足条件的总数（若实现分页）。

### 7.2 标签相关 API

#### 7.2.1 获取标签列表

- **Method**：`GET`
- **Path**：`/api/tags`
- **Query 参数**：
  - 可选 `search` 参数对标签名模糊匹配（可选实现）。
- **Response（200 OK）**：
  - 标签列表，每项包含：
    - `id`
    - `name`
    - （可选）`ticket_count`：关联 Ticket 数量。

#### 7.2.2 创建标签（可选）

> 若希望所有新标签统一由后端创建，而不是在创建/更新 Ticket 时隐式创建，则可以提供该接口。

- **Method**：`POST`
- **Path**：`/api/tags`
- **Request Body（JSON）**：
  - `name`：string，必填。
- **Response（201 Created）**：
  - 返回创建后的标签对象。

---

## 八、前端页面与交互设计（Vue3）

### 8.1 页面结构概览

本期可以只实现一个主页面，包含以下区域：

- **头部区域**
  - 应用名称（project-alpha）
  - （可选）简单说明或标语
- **筛选与搜索区域**
  - 标签筛选（多选）
  - 标题搜索输入框
  - 状态筛选（可选：全部 / 未完成 / 已完成）
- **Ticket 列表区域**
  - 以卡片或表格形式展示 Ticket；
  - 每条 Ticket 显示标题、状态、标签、创建时间等；
  - 提供完成/取消完成、编辑、删除按钮/图标。
- **创建/编辑 Ticket 区域**
  - 使用对话框（Modal）或右侧滑出面板；
  - 包含标题、描述、标签选择等表单元素。

### 8.2 组件设计建议

- 使用 Vue3 组合式 API（`<script setup>`）编写组件；
- 典型组件划分：
  - `AppHeader`：头部区域；
  - `FilterBar`：标签多选、搜索框、状态筛选；
  - `TicketList`：展示 Ticket 列表；
  - `TicketItem`：单行/单卡片 Ticket；
  - `TicketFormModal`：创建/编辑 Ticket 弹窗；
  - `TagSelector`：带模糊搜索与新建能力的多选下拉。

### 8.3 主要交互流程

#### 8.3.1 创建 Ticket 流程
- 用户点击“新建 Ticket”按钮；
- 弹出表单对话框：
  - 输入标题（必填）、描述（可选）；
  - 从下拉框选择标签或输入新标签；
- 点击“保存”：
  - 校验字段；
  - 调用 `POST /api/tickets`；
  - 成功后关闭对话框，并将新 Ticket 插入列表顶部。

#### 8.3.2 编辑 Ticket 流程
- 用户在列表中点击“编辑”；
- 打开编辑弹窗，表单默认填充当前 Ticket 数据；
- 用户修改内容后点击“保存”：
  - 调用 `PUT/PATCH /api/tickets/{id}`；
  - 成功后刷新该条 Ticket 的显示内容（无需刷新整个列表）。

#### 8.3.3 完成 / 取消完成
- 在列表中为每条 Ticket 提供一个勾选框或按钮：
  - 勾选即标记为完成，取消勾选则恢复为未完成；
  - 对应调用 `PATCH /api/tickets/{id}`，仅更新 `status` 字段；
  - 成功后更新 UI 样式（颜色、删除线等）。

#### 8.3.4 删除 Ticket
- 用户点击删除图标/按钮；
- 弹出确认对话框：
  - “确定要删除该 Ticket 吗？此操作不可撤销。”
- 用户确认后：
  - 调用 `DELETE /api/tickets/{id}`；
  - 成功后从列表中移除该条 Ticket。

#### 8.3.5 标签筛选 + 搜索
- 用户在页面顶部选择一个或多个标签；
- 前端将选中的标签 ID 和当前搜索关键字一并作为参数调用：
  - `GET /api/tickets?tag_ids=1,2&search=xxx`；
- 根据返回结果更新列表。

---

## 九、错误处理与返回约定

### 9.1 通用错误响应格式

建议统一使用如下 JSON 结构：

```json
{
  "detail": "错误说明文本",
  "code": "ERROR_CODE_OPTIONAL"
}
```

- `detail`：人类可读的错误信息；
- `code`：可选，用于前端根据错误码做细粒度处理。

### 9.2 典型错误场景

- 创建/更新 Ticket 时字段校验失败：
  - HTTP 400，`detail` 说明具体字段问题；
- 请求的 Ticket 不存在：
  - HTTP 404；
- 删除标签或更新标签时，某个标签不存在：
  - HTTP 404 或 400（按实际逻辑设计）。

---

## 十、开发与测试建议

### 10.1 开发步骤建议

- 后端：
  1. 搭建 FastAPI 基础项目结构；
  2. 定义数据库模型并完成迁移（如使用 Alembic）；
  3. 实现 Ticket 和 Tag 的 CRUD 及筛选 API；
  4. 使用自动化测试（pytest）覆盖核心业务逻辑。

- 前端：
  1. 使用 Vite + Vue3 + TypeScript 初始化项目；
  2. 设计基础布局与主题样式（可使用简单的自定义样式或轻量 UI 库）；
  3. 实现 Ticket 列表展示；
  4. 实现创建/编辑/删除/完成/筛选/搜索等交互；
  5. 对关键组件和逻辑进行单元测试（可选）。

### 10.2 测试要点

- 核心功能流程：
  - 创建 Ticket 后，能在列表中正确显示；
  - 编辑 Ticket 后，字段和标签正确更新；
  - 删除 Ticket 后，无法再通过详情或列表获取；
  - 完成/取消完成操作，状态和 UI 正确切换；
  - 标签筛选与标题搜索组合使用时，结果符合预期。

- 边界情况：
  - 空标题或超长标题的处理；
  - 重复标签名称创建的处理；
  - 多标签组合筛选无结果时的提示或空状态展示。

---

## 十一、后续扩展方向（非本期范围，仅规划）

- 增加字段：
  - 优先级（Priority）
  - 截止日期（Due Date）
  - 负责人/子任务/评论等
- 增加用户系统与权限管理：
  - 支持多用户，每个用户有自己的 Ticket；
  - 标签和 Ticket 的共享/私有设置。
- 增加统计与看板视图：
  - 根据标签、状态、时间维度统计；
  - 看板式拖拽管理（如 Todo/In Progress/Done）。

---

本设计文档覆盖了 project-alpha 项目的**核心需求**与**主要技术设计**，能够指导后续的后端 API、数据库建模以及前端页面的具体实现。后续如有新增需求，可在此基础上继续迭代扩展。


